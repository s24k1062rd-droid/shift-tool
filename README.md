# オンラインシフト作成ツール

スマホ対応のWebベースシフト作成ツールです。

## 主な機能

### 0. マルチストア対応 (SaaS)
- **店舗コード**でデータを完全に分離
- 複数の店舗が同じシステムを使用可能
- ログイン時に店舗コードを入力
- 各店舗のデータは独立して保存
- 店舗コードはヘッダーに表示

### 1. スタッフ管理
- スタッフの登録・削除
- **社員とアルバイトの区別**（登録時に選択）

### 2. 詳細設定（管理者専用）
- **時間帯管理**：シフトで使用する時間帯を自由に追加・削除可能
  - デフォルト：10-15, 17-23, 18-23, 19-23
  - カスタム時間帯の追加が可能（例：14-18, 20-24など）
- **必要人数設定**：時間帯・曜日ごとに必要な社員・アルバイト数を設定
  - 平日（日〜木）と週末（金・土）で別々に設定
  - 各時間帯の必要人数を個別にカスタマイズ

### 3. シフト希望入力（表形式・スマホ対応）
- 月別のカレンダー形式の表でシフト希望を入力
- セルをタップして時間帯を選択（チェックボックス方式）
- **時間帯は詳細設定で追加・変更可能**
- 複数時間帯の選択が可能
- 月を前後に移動して複数月のシフトを管理

### 4. 自動必要人数計算
以下のルールに基づいて自動的に必要人数をチェック（詳細設定でカスタマイズ可能）：

**デフォルト設定：**

**ランチタイム（10-15）全曜日**
- 社員：1人
- アルバイト：1人
- 最大人数：2人

**ディナータイム（日〜木）**
- 17-23：社員1人
- 18-23：社員1人、アルバイト1人
- 19-23：社員1人、アルバイト2人
- 最大人数：3人

**ディナータイム（金土祝前日）**
- 17-23：社員1人、アルバイト1人
- 18-23：社員1人、アルバイト2人
- 19-23：社員1人、アルバイト3人
- 最大人数：4人

※ これらの設定は「詳細設定」タブから変更できます

### 5. シフト表生成（表形式）
- **一行目に月、日、曜日、一列目に名前**の表形式で表示
- 社員とアルバイトを区別して表示（👔/👤アイコン）
- **自動最適化機能**：必要人数を超えている場合、適正人数まで自動調整
- 必要人数の充足状況を自動チェック
- CSV形式でのエクスポート
- データは自動保存（JSON形式）

## 自動最適化機能

シフト生成時に、以下のように自動的に最適化されます：

- **必要人数を超えている場合**：適正人数まで削減
- **社員優先**：社員の必要人数を優先して確保
- **アルバイト調整**：アルバイトの人数を自動調整
- **公平性**：複数の候補がいる場合、登録順で選択

例：
- ランチタイムに社員2人、アルバイト3人の希望がある場合
- 必要人数は社員1人、アルバイト1人なので
- 社員1人、アルバイト1人に自動調整されます

## 起動方法

### Windows（PC）

```bash
run.bat
```

をダブルクリックして起動します。

ブラウザで自動的に開くか、以下のURLにアクセスしてください：
```
http://localhost:5000
```

### ログイン

1. **店舗コード**を入力（例：`store001`、`shop_tokyo`など）
   - 各店舗は異なる店舗コードを使用してください
   - 店舗コードでデータが完全に分離されます

2. **役割を選択**
   - **管理者**: すべての機能にアクセス可能
     - 初回パスワード: `admin123`（デフォルト）
     - **重要**: ログイン後、「詳細設定」タブでパスワードを変更してください
   - **スタッフ**: シフト希望の提出と確認のみ可能（パスワード不要）

3. ログイン後、画面右上に店舗コードが表示されます

### 店舗ごとのパスワード管理

- **各店舗は独自の管理者パスワード**を持ちます
- 初回ログイン時はデフォルトパスワード（`admin123`）が設定されます
- **パスワード変更方法**：
  1. 管理者でログイン
  2. 「詳細設定」タブを開く
  3. 「管理者パスワード変更」セクションで変更
  4. 現在のパスワード、新しいパスワード（4文字以上）を入力
  5. 「パスワードを変更」ボタンをクリック
- 変更後は新しいパスワードでログインしてください

### スマホからアクセス（同じWi-Fi内）

1. PCと同じWi-Fiネットワークに接続
2. PCのIPアドレスを確認（コマンドプロンプトで `ipconfig` を実行）
3. スマホのブラウザで以下のURLを開く：
```
http://(PCのIPアドレス):5000
```

例: `http://192.168.1.100:5000`

### 外部（異なるWi-Fi）からアクセス

**Cloudflare Tunnel を使用する方法（推奨・最も簡単）**

#### ステップ 1: Cloudflareのインストール

以下のページからダウンロードしてインストール：
- https://developers.cloudflare.com/cloudflare-one/connections/connect-applications/install-and-setup/installation/

Windows の場合は `cloudflared-windows-amd64.msi` をダウンロードして実行

#### ステップ 2: トンネルの起動

プロジェクトフォルダの `start_with_tunnel.bat` をダブルクリック

または、コマンドプロンプト/PowerShellで：
```bash
# Flask を起動
.venv\Scripts\python app.py

# 別のターミナルで Cloudflare Tunnel を起動
cloudflared tunnel --url http://localhost:5000
```

#### ステップ 3: 公開URLを使用

ターミナルに表示される URL（例: `https://shift-tool-xxxxx.trycloudflare.com`）をスマホなど外部デバイスのブラウザで開く

---

**その他の方法**

**PaaS へのデプロイ（fly.io, render.com など）**

より安定したホスティングが必要な場合は、以下のサービスへのデプロイを検討：
- [Fly.io](https://fly.io/) - 無料枠で 3 つまでアプリをホスト
- [Render](https://render.com/) - 無料ティアあり
- [Heroku](https://www.heroku.com/) - 有料だが安定性が高い
   - 保存ボタンで確定

3. **シフト表タブ**
   - 「シフトを生成」ボタンでシフト表を作成
   - **月、日、曜日が一行目、名前が一列目の表形式**で表示
   - 社員とアルバイトの区別が表示される
   - 各日付・時間帯の必要人数チェック結果が表示される
   - 社員とアルバイトそれぞれの充足状況を確認可能
   - 表形式でスタッフ × 日付の一覧が表示される
   - **セルをタップ**してチェックボックスで時間帯を選択
   - 複数選択可能：10-15, 17-23, 18-23, 19-23, 10-23
   - 保存ボタンで確定

3. **必要人数タブ**
   - 前月/次月ボタンで対象月を選択
   - 表形式で時間帯 × 日付の一覧が表示される
   - **セルをタップ**して必要人数を入力
   - 保存ボタンで確定

4. **シフト表タブ**
   - 「シフトを生成」ボタンでシフト表を作成
   - 日付ごとにシフトと充足状況を表示
   - CSV出力ボタンでエクスポート可能

## スマホ対応の特徴

✨ **レスポンシブデザイン**: スマホの画面サイズに最適化
✨ **タップ操作**: すべての操作がタップで完結
✨ **チェックボックス選択**: 時間帯の入力が簡単
✨ **スクロール対応**: 横スクロールで全日程を表示
✨ **オフライン保存**: データは自動的にサーバーに保存


## 固定時間帯

シフト提出可能時間は以下の5つから選択：
- **10-15** (10時〜15時)
- **17-23** (17時〜23時)
- **18-23** (18時〜23時)
- **19-23** (19時〜23時)
- **10-23** (10時〜23時)

## データの保存

データは`shift_data/`フォルダ内に店舗ごとに保存されます：
- `shift_data/store001_data.json`
- `shift_data/store002_data.json`
など

店舗ごとに完全に独立したデータが保存され、互いに影響しません。
サーバーを再起動してもデータは保持されます。

## 必要な環境

- Python 3.6以上
- Flask（requirements.txtに記載）

## トラブルシューティング

### スマホからアクセスできない
- PCとスマホが同じWi-Fiに（同じWi-Fi）
- PCとスマホが同じWi-Fiに接続されているか確認
- PCのファイアウォール設定を確認
- `ipconfig`でPCのIPアドレスが正しいか確認

### 外部からアクセスしたい
- ngrokを使用してください（上記参照）
- ルーターのポートフォワーディング設定も可能ですが、セキュリティリスクがあります

### サーバーが起動しない
- Pythonがインストールされているか確認
- `run.bat`を実行してFlaskをインストール

### 必要人数チェックが正しくない
- 曜日が正しく認識されているか確認
- 祝日の場合は手動で確認が必要（現在は土日のみ自動判定）
## セキュリティ注意事項

このツールは社内・家庭内のローカルネットワークでの使用を想定しています。
外部インターネットからアクセスできないようにファイアウォールを設定してください。
